# Template file for 'singularity'
pkgname=singularity
version=3.2.1
revision=1
wrksrc="singularity"
build_style=configure
configure_args="--sysconfdir=/etc --localstatedir=/var --runstatedir=/run --prefix=/usr"
configure_script="./mconfig"
make_build_args="-C builddir"
make_install_target="install man"
make_dirs="/var/singularity/mnt/session 0750 root root"
hostmakedepends="go git pkg-config"
makedepends="gpgme-devel libressl-devel libuuid-devel libseccomp-devel"
depends="squashfs-tools"
short_desc="Open source container platform designed to be simple, fast, and secure"
maintainer="Emilio Palumbo <emiliopalumbo@gmail.com>"
license="BSD-3-Clause"
homepage="https://www.sylabs.io/singularity"
distfiles="https://github.com/sylabs/singularity/releases/download/v${version}/singularity-${version}.tar.gz"
checksum=d4388fb5f7e0083f0c344354c9ad3b5b823e2f3f27980e56efa7785140c9b616
make_install_args+="-C builddir"
nopie=yes
nocross="Custom build system, requires to execute binary on target system"

pre_install() {
	vmkdir usr/share/man/man1
}

post_install() {
	vlicense LICENSE.md
	vdoc README.md
	vdoc CHANGELOG.md
	vcopy examples usr/share/doc/singularity/
	vmkdir usr/share/bash-completion/completions/
	mv $DESTDIR/etc/bash_completion.d/* $DESTDIR/usr/share/bash-completion/completions/
	rm -r $DESTDIR/etc/bash_completion.d/
}
